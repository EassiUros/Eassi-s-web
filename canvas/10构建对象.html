<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <canvas width="900px" height="600px"></canvas>
</body>
</html>
<script>
    // 1.构造函数
    function LineChart(ctx) {
        // 获取画布高度和宽度
        this.ctx = ctx || document.querySelector("canvas").getContext("2d");
        this.canvasWidth = this.ctx.canvas.width;
        this.canvasHeight = this.ctx.canvas.height;
        // 网格大小
        this.gridSize = 10;
        // 坐标系间隔
        this.space = 20;
        // 坐标系原点
        this.X0 = this.space;
        this.Y0 = this.canvasHeight - this.space;
        // 箭头大小
        this.arrowSize = 10;
        // 点的大小
        this.dottedSize = 6;
        // 点的坐标和数据有关
    }
    // 2.行为方法

    LineChart.prototype.init = function (data) {
        this.drawGrid();
        this.drawAxis();
        this.drawDotted(data);
    };
    // 绘制网格
    LineChart.prototype.drawGrid = function () {
        // 绘制X方向直线
        var xLineTotal = Math.floor(this.canvasHeight / this.gridSize);
        for(var i = 0; i <= xLineTotal; i++){
            this.ctx.beginPath();
            this.ctx.moveTo(0, this.gridSize * i - 0.5);
            this.ctx.lineTo(this.canvasWidth, this.gridSize * i - 0.5);
            this.ctx.strokeStyle = "#eee";
            this.ctx.stroke();
        }
        // 绘制y方向直线
        var yLineTotal = Math.floor(this.canvasWidth / this.gridSize);
        for(var i = 0; i <= yLineTotal; i++){
            this.ctx.beginPath();
            this.ctx.moveTo(this.gridSize * i - 0.5, 0);
            this.ctx.lineTo(this.gridSize * i - 0.5, this.canvasWidth);
            this.ctx.strokeStyle = "#eee";
            this.ctx.stroke();
        }
        
    };
    // 绘制坐标系
    LineChart.prototype.drawAxis = function () {
        // 绘制坐标系
        // 绘制X轴
        this.ctx.beginPath();
        this.ctx.moveTo(this.X0, this.Y0);
        this.ctx.lineTo(this.canvasWidth - this.space, this.Y0);
        this.ctx.lineTo(this.canvasWidth - this.space - this.arrowSize, this.Y0 - this.arrowSize / 2);
        this.ctx.lineTo(this.canvasWidth - this.space - this.arrowSize, this.Y0 + this.arrowSize / 2);
        this.ctx.lineTo(this.canvasWidth - this.space, this.Y0);
        this.ctx.closePath();
        this.ctx.strokeStyle = "#333";
        this.ctx.stroke();
        this.ctx.fill();
        // 绘制Y轴
        this.ctx.beginPath();
        this.ctx.moveTo(this.X0, this.Y0);
        this.ctx.lineTo(this.X0, this.space);
        this.ctx.lineTo(this.X0 - this.arrowSize / 2, this.space + this.arrowSize);
        this.ctx.lineTo(this.X0 + this.arrowSize / 2, this.space + this.arrowSize);
        this.ctx.lineTo(this.X0, this.space);
        this.ctx.closePath();
        this.ctx.strokeStyle = "#333";
        this.ctx.stroke();
        this.ctx.fill();

    };
    // 绘制点
    LineChart.prototype.drawDotted = function(data) {
        // 1.数组坐标转换为canvas坐标
        // 2.进行点的绘制
        // 3.把点连起来
        var that = this;
        var preCanvasX = 0;
        var preCanvasY = 0;
        data.forEach(function(item,i){
            // canvasX坐标 = 原点坐标 + data坐标
            // canvasY坐标 = 原点坐标 - data坐标
            var canvasX = that.X0 + item.x;
            var canvasY = that.Y0 - item.y;
            // 绘制点
            that.ctx.beginPath();
            that.ctx.moveTo(canvasX - that.dottedSize / 2, canvasY - that.dottedSize / 2);
            that.ctx.lineTo(canvasX + that.dottedSize / 2, canvasY - that.dottedSize / 2);
            that.ctx.lineTo(canvasX + that.dottedSize / 2, canvasY + that.dottedSize / 2);
            that.ctx.lineTo(canvasX - that.dottedSize / 2, canvasY + that.dottedSize / 2);
            that.ctx.closePath();
            that.ctx.fillStyle = "#000";
            that.ctx.fill();
            // 连线
            if(i == 0)
            {
                that.ctx.beginPath();
                that.ctx.moveTo(that.X0, that.Y0);
                that.ctx.lineTo(canvasX, canvasY);
                that.ctx.stroke();
            }else{
                that.ctx.beginPath();
                that.ctx.moveTo(preCanvasX, preCanvasY);
                that.ctx.lineTo(canvasX, canvasY);
                that.ctx.stroke();
            }
            preCanvasX = canvasX;
            preCanvasY = canvasY;

        });
        // data.forEach(function(item,i){
        //     // canvasX坐标 = 原点坐标 + data坐标
        //     // canvasY坐标 = 原点坐标 - data坐标
        //     var canvasX = that.X0 + item.x;
        //     var canvasY = that.Y0 - item.y;
        //     // 绘制点
        //     that.ctx.beginPath();
        //     that.ctx.moveTo(canvasX - that.dottedSize / 2, canvasY - that.dottedSize / 2);
        //     that.ctx.moveTo(canvasX + that.dottedSize / 2, canvasY - that.dottedSize / 2);
        //     that.ctx.moveTo(canvasX + that.dottedSize / 2, canvasY + that.dottedSize / 2);
        //     that.ctx.moveTo(canvasX - that.dottedSize / 2, canvasY + that.dottedSize / 2);
        //     that.ctx.closePath();
        //     that.ctx.fill();
        // })
    }


    // 3.初始化
    var data = [
        {
            x:100,
            y:100
        },
        {
            x:200,
            y:200
        },
        {
            x:300,
            y:300
        }
    ];
    var LineChart = new LineChart();
    LineChart.init(data);
</script>